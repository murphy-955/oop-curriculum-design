@startuml
title 体育赛事直播系统 - 核心请求流程

participant "用户" as User
participant "网关" as Gateway
participant "事件处理" as EventProcessor
participant "状态服务" as MatchState
participant "统计服务" as PlayerStats
participant "可视化" as Visualization
participant "WebSocket" as WS
participant "缓存" as Redis
participant "数据库" as DB
participant "消息队列" as Kafka

User -> Gateway: 1. 上传事件流
Gateway -> EventProcessor: 2. 异步处理事件
EventProcessor -> MatchState: 3. 更新比赛状态
EventProcessor -> PlayerStats: 4. 更新球员统计
MatchState -> Redis: 5. 缓存状态数据
PlayerStats -> Redis: 6. 缓存统计数据
EventProcessor -> Kafka: 7. 发布处理结果

User -> Gateway: 8. 请求可视化数据
Gateway -> Visualization: 9. 获取可视化数据
Visualization -> MatchState: 10. 获取比赛状态
Visualization -> PlayerStats: 11. 获取球员统计
MatchState -> Redis: 12. 优先读取缓存
PlayerStats -> Redis: 13. 优先读取缓存
Redis -> MatchState: 14. 返回缓存数据
Redis -> PlayerStats: 15. 返回缓存数据
MatchState -> Visualization: 16. 返回状态数据
PlayerStats -> Visualization: 17. 返回统计数据
Visualization -> Gateway: 18. 返回渲染结果
Gateway -> User: 19. 返回可视化界面

User -> WS: 20. 建立WebSocket连接
Kafka -> WS: 21. 推送实时事件
WS -> User: 22. 实时更新界面

DB <- Redis: 23. 数据异步持久化

@enduml