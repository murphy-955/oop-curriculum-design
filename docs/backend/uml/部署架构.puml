@startuml
title 微服务部署架构

node "负载均衡层" {
  [Nginx集群] as Nginx
}

node "网关层" {
  [Spring Cloud Gateway集群] as Gateway
}

node "业务服务层" {
  [事件摄取服务集群] as Ingest
  [事件处理服务集群] as Processor
  [比赛状态服务集群] as State
  [球员统计服务集群] as Stats
  [可视化服务集群] as Viz
  [WebSocket服务集群] as WS
}

node "中间件层" {
  [Nacos集群] as Nacos
  [Redis集群] as Redis
  [Kafka集群] as Kafka
  [MySQL集群] as MySQL
}

node "监控层" {
  [Prometheus] as Prometheus
  [Grafana] as Grafana
  [SkyWalking] as APM
}

[用户] -> Nginx: HTTP/WebSocket
Nginx -> Gateway: 负载均衡
Gateway -> Ingest: 服务发现
Gateway -> Processor: 服务发现
Gateway -> State: 服务发现
Gateway -> Stats: 服务发现
Gateway -> Viz: 服务发现
Gateway -> WS: 服务发现

Ingest -> Kafka: 发布事件
Processor -> Kafka: 订阅/发布
WS -> Kafka: 订阅事件

State -> Redis: 缓存读写
Stats -> Redis: 缓存读写
Viz -> Redis: 缓存读取

State -> MySQL: 数据持久化
Stats -> MySQL: 数据持久化

所有服务 -> Nacos: 注册/发现
所有服务 -> Prometheus: 监控指标
Prometheus -> Grafana: 数据可视化
所有服务 -> APM: 链路追踪

@enduml